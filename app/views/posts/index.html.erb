<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li></ul>
      <ul class="nav navbar-nav">
        <li ><a href="#">Lougram</a></li></ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= current_user.email %> <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="#">View Profile</a></li>
            <li class="divider"></li>
            <li><a href="#"><%= link_to 'Edit profile', edit_user_registration_path%></a></li>
            <li class="divider"></li>
            <li><a href="#"><%= link_to "Logout", destroy_user_session_path, method: :delete%></a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="jumbotron posts_index">
	<div class="container">
    <h1>Lougram</h1>
    <p class="lead">You are on the posts page, where you can view your own posts and of people you follow.</p>
    <p><a class="btn btn-lg btn-success" href="posts/new" role="button">Post a Photo</a></p>
  </div>
</div>

<div class='container'>
	<% if @posts.any? %>
	<div class="all-posts">
	 	<% @posts.each do |post| %>
			<div class='row'>  	
	 			<div class='col-md-2 col-md-offset-1'>
	 				<%= post.user.email %>
	 			</div>
	 			
	 			<div class='col-md-5 post' data-id="<%= post.id %>">

	 				<div class="panel panel-default">
	  
					  <div class="panel-heading picture_panel"><%= image_tag post.picture.url(:medium), class: 'uploaded-picture' %></div>
					  
					  <div class="panel-body">
					    <ul class="list-group">	

					      <li class="list-group-item">
					      <% if post.likes.any? {|l| l.user_id == current_user.id } %>
					      	<span class="liked_already"><%=" ❤ #{post.likes.count}"%></span>
					      <% else %>
					      		<%= link_to " ❤ #{post.likes.count}", post_likes_path(post), class: 'like-btn' %>
					      <% end%>
					      	| <%= link_to "Delete post", post_path(post), method: :delete %> 
					      	| <%= link_to "Show more", '#', data: {toggle: 'modal', target: ".image-modal-#{post.id}"} %></li>
					      <li class="list-group-item caption">
					      	<%= post.caption %> 
					        <% post.hashtags.each do |hashtag| %>
					          <%= link_to hashtag.title, hashtag_path(hashtag) %>
					         <% end%>

					      <% if post.comments.any? %>
					       <li class="list-group-item comment_count"><%= pluralize(post.comments.count, 'comment') %></li>
					   			<% post.comments.each do |comment| %>
							      <li class="comment_display list-group-item">		   			
						   				<span class="commenter"><%= comment.user.email %>:    </span> 
						   					<%= comment.comment %>
						   					<%= link_to '྾', post_comment_path(post, comment), method: :delete %>
							      </li>
					   			<%end%>						
						 		<%end%>

						     <li class="comment_form list-group-item">
					   			<%= form_for [post, @comment] do |f| %>

										<%= f.label :comment, "Comment:" %>
										<%= f.text_area :comment, placeholder: "Write a comment..."%><br />
										<%= f.submit %>

									<%end%>				
					      </li>

									<div class="modal fade image-modal-<%= post.id%> ">
									  <div class="modal-dialog modal-lg">
									    <div class="modal-content">
									      <div class="modal-header">
									        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									        <h4 class="modal-title">Posted by <%= post.user.email %></h4>
									      </div>
									      <div class="modal-body">
									      	<%= image_tag post.picture.url%>
									      </div>
									      
									    </div>
									  </div>
									</div>

					        </li>
					    
					    
					    </ul>
					  </div>
					</div>

		 		</div>
		 		
			</div>

	  <%end%>	
	</div>

	<%else%>
		<p>There are no posts yet</p>
	<%end%>
</div>


<!DOCTYPE HTML>
<html>
	<head>
	<meta name="viewport" content="width=320; user-scalable=no" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>ColorThief Demo</title>
	
	<script type="text/javascript" charset="utf-8" src="jquery-2.0.0.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="quantize.js"></script>
	<script type="text/javascript" charset="utf-8" src="color-thief.js"></script>
        
	<style>
	#yourimage {
		width:100%;	
	}
	
	#swatches {
		width: 100%;
		height: 50px;	
	}
 
	.swatch {
		width:18%;
		height: 50px;
		border-style:solid;
		border-width:thin;	
		float: left;
		margin-right: 3px;	
	}
	</style>
	</head>
 
	<body>
 
		<input type="file" capture="camera" accept="image/*" id="takePictureField">
        
		<img id="yourimage">
 
		<div id="swatches">
			<div id="swatch0" class="swatch"></div>
			<div id="swatch1" class="swatch"></div>
			<div id="swatch2" class="swatch"></div>
			<div id="swatch3" class="swatch"></div>
			<div id="swatch4" class="swatch"></div>
		</div>
		
    <script>
	var desiredWidth;
 
    $(document).ready(function() {
        console.log('onReady');
		$("#takePictureField").on("change",gotPic);
		$("#yourimage").load(getSwatches);
		desiredWidth = window.innerWidth;
        
        if(!("url" in window) && ("webkitURL" in window)) {
            window.URL = window.webkitURL;   
        }
		
	});
 
	function getSwatches(){
		var colorArr = createPalette($("#yourimage"), 5);
		for (var i = 0; i < Math.min(5, colorArr.length); i++) {
			$("#swatch"+i).css("background-color","rgb("+colorArr[i][0]+","+colorArr[i][1]+","+colorArr[i][2]+")");
			console.log($("#swatch"+i).css("background-color"));
		}
	}	
	
    //Credit: https://www.youtube.com/watch?v=EPYnGFEcis4&feature=youtube_gdata_player
	function gotPic(event) {
        if(event.target.files.length == 1 && 
           event.target.files[0].type.indexOf("image/") == 0) {
            $("#yourimage").attr("src",URL.createObjectURL(event.target.files[0]));
        }
	}
	
	
        
    </script>    
	</body>
 
</html>